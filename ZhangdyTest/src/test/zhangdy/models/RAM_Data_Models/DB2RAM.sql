CREATE SCHEMA RAM;

CREATE TABLE RAM.TAPPROLE (
		ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		IDUSER INTEGER NOT NULL,
		APPROLEID SMALLINT NOT NULL,
		APPID SMALLINT NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TAPPROLESCOPE (
		CUSTTYPE SMALLINT NOT NULL,
		ISOCNTRYCODE CHAR(2) NOT NULL,
		IDAPPROLE INTEGER NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TAUDIT (
		TYPE CHAR(50) NOT NULL,
		TS TIMESTAMP NOT NULL,
		PERFORMER CHAR(50) NOT NULL,
		DETAILS CLOB(1024) NOT NULL NOT LOGGED
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TEVENTSUB (
		EVENTTYPE SMALLINT NOT NULL,
		CUSTNUM CHAR(10) NOT NULL,
		ISOCNTRYCODE CHAR(2) NOT NULL,
		IDAPPROLE INTEGER NOT NULL,
		DVALIDATED DATE DEFAULT CURRENT DATE NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TUSER (
		ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		PERMID CHAR(20) NOT NULL,
		AUTHSERVICE CHAR(5) NOT NULL,
		FBUSPARTNER CHAR(1),
		APPID SMALLINT NOT NULL,
		TSDELETED TIMESTAMP,
		TSCREATED TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
		TSLASTLOGIN TIMESTAMP
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TREQUEST (
		ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		IDREQUESTOR INTEGER NOT NULL,
		IDAPP SMALLINT NOT NULL,
		APPROVERTYPE CHAR(3) NOT NULL,
		REQUESTTYPE CHAR(10) NOT NULL,
		IDAPPROVER INTEGER NOT NULL,
		STATUS CHAR(8) NOT NULL,
		REQUESTXML CLOB(1024) NOT NULL NOT LOGGED,
		TSLASTUPDATED TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL,
		TSCREATED TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TREQUEST_ARCHIVE (
		REQUESTXML CLOB(1024) NOT NULL NOT LOGGED,
		TSCREATED TIMESTAMP DEFAULT CURRENT TIMESTAMP NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TCONTROLDATA (
		CONTROLKEY CHAR(50) NOT NULL,
		VALUE VARCHAR(256) NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TGROUPADMIN (
		APPID SMALLINT NOT NULL,
		POOLID SMALLINT NOT NULL,
		USERID INTEGER NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TGROUP (
		ACTIVATED CHAR(1) NOT NULL,
		APPID SMALLINT NOT NULL,
		CUSTTYPE SMALLINT NOT NULL,
		ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		ISOCNTRYCODE CHAR(2) NOT NULL,
		NAME CHAR(60) NOT NULL,
		POOLID SMALLINT NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TGROUPROLE (
		ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 NO CYCLE CACHE 20),
		GROUPID INTEGER NOT NULL,
		USERID INTEGER NOT NULL,
		ROLEID SMALLINT NOT NULL,
		NOTIFY CHAR(1) NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TRULE (
		RULEID SMALLINT NOT NULL,
		GROUPID INTEGER NOT NULL,
		VALUE SMALLINT NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TCUSTNUM (
		CUSTNUM CHAR(10) NOT NULL,
		ISOCNTRYCODE CHAR(2) NOT NULL,
		GROUPID INTEGER NOT NULL,
		COMPANYNAME CHAR(60) NOT NULL
	)
	DATA CAPTURE NONE ;

CREATE TABLE RAM.TGROUPEVENTSUB (
		GROUPROLEID INTEGER NOT NULL,
		EVENTID SMALLINT NOT NULL,
		SUBSCRIBED CHAR(1) NOT NULL
	)
	DATA CAPTURE NONE ;

ALTER TABLE RAM.TAPPROLE ADD CONSTRAINT APPROLE_PK PRIMARY KEY (ID);

ALTER TABLE RAM.TAPPROLESCOPE ADD CONSTRAINT APPROLESCOPE_PK PRIMARY KEY (IDAPPROLE, CUSTTYPE, ISOCNTRYCODE);

ALTER TABLE RAM.TAUDIT ADD CONSTRAINT AUDIT_PK PRIMARY KEY (TYPE, TS);

ALTER TABLE RAM.TEVENTSUB ADD CONSTRAINT EVENTSUB_PK PRIMARY KEY (IDAPPROLE, EVENTTYPE, CUSTNUM, ISOCNTRYCODE);

ALTER TABLE RAM.TUSER ADD CONSTRAINT USER_PK PRIMARY KEY (ID);

ALTER TABLE RAM.TREQUEST ADD CONSTRAINT REQUEST_PK PRIMARY KEY (ID);

ALTER TABLE RAM.TCONTROLDATA ADD CONSTRAINT TDATAOBJECT_PK PRIMARY KEY (CONTROLKEY);

ALTER TABLE RAM.TGROUPADMIN ADD CONSTRAINT TGroupAdmin_PK PRIMARY KEY (APPID, POOLID, USERID);

ALTER TABLE RAM.TGROUP ADD CONSTRAINT TGROUP_PK PRIMARY KEY (ID);

ALTER TABLE RAM.TGROUPROLE ADD CONSTRAINT TGROUPROLE_PK PRIMARY KEY (ID);

ALTER TABLE RAM.TRULE ADD CONSTRAINT TRULE_PK PRIMARY KEY (GROUPID, RULEID);

ALTER TABLE RAM.TCUSTNUM ADD CONSTRAINT TCUSTNUM_PK PRIMARY KEY (CUSTNUM, ISOCNTRYCODE);

ALTER TABLE RAM.TGROUPEVENTSUB ADD CONSTRAINT TGROUPEVENTSUB_PK PRIMARY KEY (EVENTID, GROUPROLEID);

ALTER TABLE RAM.TAPPROLE ADD CONSTRAINT APPROLE_FK FOREIGN KEY (IDUSER)
	REFERENCES RAM.TUSER (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TAPPROLESCOPE ADD CONSTRAINT APPROLESCOPE_FK FOREIGN KEY (IDAPPROLE)
	REFERENCES RAM.TAPPROLE (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TEVENTSUB ADD CONSTRAINT EVENTSUB_FK FOREIGN KEY (IDAPPROLE)
	REFERENCES RAM.TAPPROLE (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TREQUEST ADD CONSTRAINT REQUEST_FK FOREIGN KEY (IDREQUESTOR)
	REFERENCES RAM.TUSER (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TGROUPADMIN ADD CONSTRAINT TGADMIN_TUSER_FK FOREIGN KEY (USERID)
	REFERENCES RAM.TUSER (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TGROUPROLE ADD CONSTRAINT TGROLE_TGROUP_FK FOREIGN KEY (GROUPID)
	REFERENCES RAM.TGROUP (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TGROUPROLE ADD CONSTRAINT TGROLE_TUSER_FK FOREIGN KEY (USERID)
	REFERENCES RAM.TUSER (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TRULE ADD CONSTRAINT TRULE_TGROUP_FK FOREIGN KEY (GROUPID)
	REFERENCES RAM.TGROUP (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TCUSTNUM ADD CONSTRAINT TCUSTNUM_TGROUP_FK FOREIGN KEY (GROUPID)
	REFERENCES RAM.TGROUP (ID)
	ON DELETE CASCADE;

ALTER TABLE RAM.TGROUPEVENTSUB ADD CONSTRAINT GEVENTSUBGROLEFK FOREIGN KEY (GROUPROLEID)
	REFERENCES RAM.TGROUPROLE (ID)
	ON DELETE CASCADE;

